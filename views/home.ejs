<h1>Codeial / <%= title%></h1>
<h2>Home page</h2>

<section id="feed-posts">
  <h4>Posts</h4>
  <%# Show the post form only if user is signed in %>
  <% if (locals.user) { %>
  <form id="new-post-form" action="/posts/create" method="POST">
    <textarea name="content" rows="3" cols="30" placeholder="Type here.." required></textarea>
    <input type="submit" value="Post">
  </form>
  <% } %>
  <div class="posts-list-container">
    <ul>
      <% for (post of posts) {%>
      <li>
        <p>
          <% if (locals.user && locals.user.id == post.user.id) { %>
          <small>
            <a href="/posts/destroy/<%= post.id %>">
              <button type="button" name="button">X</button>
            </a>
          </small>
          <% } %>
        </p>
        <p>
          <%=post.content%>
          <small>
            <%= post.user.name %>
          </small>
        </p>
        <div class="post-comments">
          <%if (locals.user) {%>
          <form action="comments/create" method="post">
            <input type="text" name="content" placeholder="Type here to add comments..." required>
            <input type="hidden" name="post" value="<%= post._id %>">
            <input type="submit" value="Add comment">
          </form>
          <% } %>

          <div class="post-comments-list">
            <ul id="post-comments-<%= post._id%>">
              <% for (comment of post.comments){%>
              <p>
                <%= comment.content %>
                <br>
                <% if (locals.user && locals.user.id == comment.user.id) { %>
                <small>
                  <a href="/comments/destroy/<%= comment.id %>">
                    <button type="button" name="button">X</button>
                  </a>
                </small>
                <% } %>
                <small>
                  <%= comment.user.name %>
                </small>
              </p>
              <% }%>
            </ul>
          </div>
        </div>
      </li>

      <% } %>

    </ul>
  </div>
</section>
